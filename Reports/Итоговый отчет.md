 **Оглавление:**
 - [Hello World](#item-one)
 - [First Item](#item-two)
 - [Second Item](#item-three)
 
 <!-- headings -->
 <a id="item-one"></a>
 ### Hello World
 Hello world content goes here
 
 <a id="item-two"></a>
 ### First Item
 First item content goes here
 
 <a id="item-three"></a>
 ### Second Item
 Second item content goes here
# Постановка задачи 

## Общее описание поставленной проблемы

Врата Вечности являются важным элементом для перемещения между различными мирами. Для обеспечения их бесперебойной работы необходимо отслеживать состояние портала через специальный показатель — коэффициент Гармония Бессмертия. Этот коэффициент отражает общее состояние портала.

## Общая постановка задачи

Необходимо построить модель машинного обучения, которая будет предсказывать значение коэффициента "Гармония Бессмертия", который отвечает за общую работоспособность портала, на основе данных о его работе и характеристиках. 

## Данные

Имеется целевой набор данных о характеристиках работы поратала: 

- Вектор Мощи - позиция магического механизма, управляющего интенсивностью перехода через портал.
- Скорость перехода через портал - скорость, с которой портал перемещает объект через пространство.
- Приток Силы Потока - поток магической силы, текущий через ядро портала, обеспечивая его стабильную работу.
- Ритм магического ядра - число оборотов магического ядра портала в минуту.
- Поток Энергий - число оборотов генератора эфира, преобразующего внешнюю энергию в магическую.
- Сила Левого Потока -мощность магического потока, текущего через левую сторону портала, поддерживая его баланс.
- Сила Правого Потока - мощность магического потока, текущего через правую сторону портала, обеспечивая равномерное распределение энергии.
- Пламя стихий - температура магической энергии, исходящей из высокого магического источника портала, в градусах Цельсия.
- Температура вдоха Истока - температура воздуха, входящего в магический ускоритель портала, в градусах Цельсия.
- Температура выдоха Истока - температура воздуха, исходящего из магического ускорителя портала, в градусах Цельсия.
- Приток давления Выдоха Истока - давление магического потока на выходе из магического источника высокого 
- Давление вдоха Истока - давление воздуха, входящего в магический ускоритель.
- Давление выдоха Истока - давление воздуха, исходящего из магического ускорителя.
- Древний Ветер - давление древней магической энергии, покидающей портал в виде выхлопного потока.
- Печать Чародея - параметр управления магическим впрыском в сердце портала, выраженный в процентах.
- Эмульсия Истока - количество магического топлива, подпитывающего портал.
- Дыхание Истока - коэффициент, отображающий степень угасания магического ускорителя.

Также для оценки работы портала можно использовать расчетные показатели. 

- Для определения общей мощности потоков сначала сложите значения "Силы Левого Потока" и "Силы Правого Потока", чтобы получить представление о совокупной мощности.
- Для более полной картины суммарной силы всех потоков дополнительно объедините "Силу Левого Потока", "Силу Правого Потока" и "Приток Силы Потока".
- Общую силу ядра можно оценить, умножив "Ритм магического ядра" на "Приток Силы Потока", что даст показатель общей мощности ядра. 
- Общее давление на выходе можно рассчитать, сложив значения "Притока давления Выдоха Истока" и
"Давления выдоха Истока".
- Магическую производительность определяет отношение "Скорости перехода через портал" к "Эмульсии Истока" - это покажет, насколько эффективно топливо поддерживает скорость перехода. 
- Эффективность самого ядра можно вычислить, разделив его общую силу на "Эмульсию Истока".
- Для расчёта магической мощности потребуется учесть "Эмульсию Истока", общее давление и разницу между "Пламенем Стихий" и "Температурой вдоха Истока".
- Оценить степень износа магических источников поможет отношение "Дыхания Истока" к "Гармонии Бессмертия".
- Абсолютное значение разницы между "Дыханием Истока" и "Гармонией Бессмертия" отразит расхождения в стабильности магии. 
- Баланс угасания можно определить, разделив разницу между "Дыханием Истока" и "Гармонией Бессмертия" на "Скорость перехода через портал".

Гармония Бессмертия - целевая переменная - коэффициент, указывающий на состояние магического ядра портала и его стабильность, требующий магического восстановления в случае снижения.


## Цели

1. Прогнозирование состояния портала. Модель должна предсказывать будущие значения коэффициента Гармония Бессмертия, чтобы своевременно реагировать на изменения в состоянии портала для предотвращения катастроф. 
2. Оптимизация работы. На основе предсказанного коэффициента можно проводить дополнительные мероприятия по мониторингу работы Портала, проводить анализ влияния тех или иных признаков на общий показатель стабильности.
3. Снижение рисков. Так как прогнозируемый коэффициент оказывает влияние не только на способность открывать проходы в друугие миры, но и стать причиной технолгенной катастрофы, то предсказание критических значений с заданной коэффициента поможет избежать таких последствий. 

Критическое значение. Если значение Гармонии Ьессмертия ниже 0.983, то использование Портала становится небезопасным

## Методы решения

Представленная задача является задачей регрессии. 

Для оценки выбора метода будут учитывататься размер и сложность данных, их структура, наличие зависимостей (мультиколлинеарность) и объем доступных данных.

Предварительно предполагается использование следующий моделей машинного обучения:
- Линейная многофакторная регрессия для первичных экспериментов и оценки базовых параметров. 
- Регуляризированные модели - для работы в условиях возможной мультиколлинеарности, и для работы по отбору признаков.
- Деревья решениий - для анализа работы в условиях наличия  нелинейных зависимостей. 
- Случайный лес - для задачи, если итоговый признаки будут иметь сложную взаимосвязь. 
- Градиентный  бустинг - как один из самых мощных методов машинного обучения. 

Возможно также использование методов стакинга как комбинации разных моделей для получения наилучшего результата. 

В рамках задачи не будут рассматриваться нейронные сети. Их использование возможно как этап будущих исследований ии оптимизации модели, полученной в рамках текущей задачи. 

## Метрики качества

Оценка стабильности портала является критичной не только для логистики между мирами, но и безопасности окрущающей среды и населения. Поэтому к точности будут предъявляться строгие требования. 

Предлагается использование следующих метрик: 

- Среднеквадратичная ошибка (MSE — Mean Squared Error) - средняя величина квадратов разностей между реальными и предсказанными значениями. 
- Корень из среднеквадратичной ошибки (RMSE — Root Mean Squared Error).
- Абсолютная ошибка (MAE — Mean Absolute Error) - средняя абсолютная разница между реальными и предсказанными значениями. 
- Коэффициент детерминации - показатель доли дисперсии целевой переменной, объясненную моделью.

## Требования к качеству 

- Модель должна предсказывать коэффициент Гармонии с точностью не хуже 95%. 
- RMSE меньше или равно 0.02.
- MAE меньше или равно 0,01.
- Коэффициент  детерминации должен быть равен 0.95 или более.

## Ожидаемые результаты

1. Модель, способная точно предсказывать коэффициент Гармонии портала на основе данных о работе портала.
2. Система раннего предупреждения о возможных проблемах в работе портала.
3. Предложения по оптимизации работы портала и будущей работе над проблемой. 

# Предобработка данных

## Общее описание алгоритма 

В рамках разведывательного анализа данных и процесса обработки данных исходного датасета были произведены следующие шаги. 

- поиск и заполнение отсутствующих данных. 
- устранение нетипичных значений - выбросов. 
- устранение дубликатов и т.д. 

Для подготовки готового датасета были проведены следующиие действия над данными. 

1. Аналитики Температура выдоха Истока и Древний Ветер имели текстовый тип данных, так как имели в себе несколько текстовых значений - "Исток не вернул выдох" и "Древний Ветер развеялся". Такие значения были заменены нулями. 
2. Пустых значений в данных не наблюдалось. Дополнительных действий не потребовалось. 
3. Дубликатов в данных не наблюдалось. Дополнительных действий не потребовалось. 
4. В датасете имелись два показателя - Температура вдоха Истока и Давление вдоха Истока - которые имели константное значение. Показатели были удалены из датасета. 
5. В рамках анализа выбросов будет использоваться метод, основанный на стандартизированной оценке, для анализа распределений числовых признаков. Метод показал, что в нашем датасете по результатам предобработки данных нет существенных выбросов. 

По результатам EDA была замечана очень сильная мультиколлнеарность между показателями. Для этого был проведен отдельный этап, посвященный корректировке датасета на мультиколлинеарность.

## Решение проблемы с мультиколлинеарностью

Корреляционная матрица показаза, что между большинством факторов есть крайне высокая мультиколлинеарность, что в итоге повлекло бы за собой проблемы в будущих моделях. 

Для устраненения мультиколлинеарности датасета было предложено следующее решение: 
1. Проанализировать два различныхх датасета - один с обычными (исходными) данными, а другой с расчетными показателями. 
2. Выделить показатели с наибольшей коллинеарностью и убрать их из датасета. Такую процедуру провести для обоих датасетов. 
3. Отобрать данные, у которых мультиколлнеарность между друг другом  будет мининальной. Для этого был использован коэффициент инфляции дисперсии или VIF. VIF — это мера, которая помогает обнаружить степень мультиколлинеарности в множественной регрессионной модели. принималось, что если значение VIF выше 5, между у аналитики существует большая линейная зависимость с другими переменными. Для каждой итерации из датасета будем убирать показатель, у которого метрика VIF будет самой  большой. Такую логику будем применять до тех пор, пока у оставшихся аналитик VIF будет менее 5. 
4. После данной операции для обоих датасетов, будет произведено объединение датасетов в один. Для него также применена логика, описанная в п 3. 

После вышеописанных шагов будет софрмироват датасет для построения моделей машинного обучения. 

## Итоговый датасет для построения моделей

По результатам этапа был сформирован итоговый датасет, готовый к построению моделей. 

Итоговый датасет имеет следующую структуру. 

1. Поток Энергий - число оборотов генератора эфира, преобразующего внешнюю энергию в магическую.
2. Древний Ветер - давление древней магической энергии, покидающей портал в виде выхлопного потока.
3. Дыхание Истока - коэффициент, отображающий степень угасания магического ускорителя.
4. Магическая производительность - показатель эффективности того, как топливо поддерживает скорость перехода (расчетный показатель).  
5. Расхождения в стабильности магии -  абсолютное значение разницы между "Дыханием Истока" и "Гармонией Бессмертия" (расчетный показатель). 
6. Гармония Бессмертия - целевая переменная - коэффициент, указывающий на состояние магического ядра портала и его стабильность, требующий магического восстановления в случае снижения.

Итоговый обработанный датасет сохранен в директорию Data/Processed.

# Подготовка моделей

## Общее описание

На основе подготовленного датасета была произведена подготовка моделей машинного обучения. 

Перед подготовкой данных были произведены стандартные операции по разделению признаков и прогнозируемой переменной, произведена нормализация признаков для устранения выбросов и приведения данных к общему виду. 

Были рассмотрены следующие модели. 
1. Линейная многофакторная регрессия для первичных экспериментов и оценки базовых параметров. 
2. Регуляризированные модели - для работы в условиях возможной мультиколлинеарности, и для работы по отбору признаков.
3. Деревья решениий - для анализа работы в условиях наличия  нелинейных зависимостей. 
4. Случайный лес - для задачи, если итоговый признаки будут иметь сложную взаимосвязь. 
5. Градиентный  бустинг - как один из самых мощных методов машинного обучения. 

Также было протестировано применение ансамблиевых методов регрессии - Stacking и Voting регрессоров. 

## Общий алгоритм

Для более оптимального построения моделей создадим несколько функций. 
- функция загрузки данных в модель машинного обучения и вывод основных метрик. 
- проверка модели на уровень переобучениия. 
Данные функции были объединены в одну функцию для организации более полного отчета о работе модели. 

Далее данная функция была вызвана для каждой из моделей.

Итоговый вывод функции содержал данные о метриках модели - RMSE, MAE, R^2, а также выводил результаты, склонная ли модели к переобучению или нет. 

## Общий результат

Лучше всего для нашего кейса подходят модели стандартной регрессии и модели Lasso и Ridge с регуляризацией. Несмотря на то, что модель градиентного бустинга и также показала хороший результат, уровень склонности к переобучению у нее несколько выше, чем у моделей выше. 

Модели, основанные на дереве решений, было решено не использовать из-за высокого уровня переобучения. 

После построения моделей было решено протестировать возможность использования ансамблиевых методов.

Результаты Stacking-ансамля показали лучшие результаты по метрикам (по коэффициенту детерминации, например). Поэтому в итоге можно сказать, что лучше всего для решения задачи нам будут подходить следующие модели:

1. Модель линейной регрессии (с учетом того, что в датасете необходимо работать над решение проблемы мультиколлинеарности факторов). 
2. Модели Lasso и Ridge, так как они лучше всего работаю в условиях, когда данные имеют очень тесные связи. 
3. Stacking-ансамли, которые включают модели линейной регрессии и и модели с регуляризацией. 

Все модели подошли под требования к метрикам качества, которые были выделены в рамках этапа по постановке задачи:
- Модель должна предсказывать коэффициент Гармонии с точностью не хуже 95%. 
- RMSE меньше или равно 0.02.
- MAE меньше или равно 0,01.
- Коэффициент  детерминации должен быть равен 0.95 или более.

Модели также строятся и сохраняются скриптом "Model save.py". Готовые модели доступны в директории Models.

# Итоговый результат

## Общее описание

В результате работы над кейсом были пройдены следующие этапы:
1. Выполнен разведочный анализ данных. 
2. Проведена очистка датасета.
3. Устранена проблема мультиколлинеарности признаков.  
4. Отобраны итоговы признаки для моделей. 
5. Подготовлены и сохранены модели машинного обучения. 
6. Подготовлены финальные отчеты по работе. 

Итоговым результатом являются четыре модели:
- Линейная регрессия. 
- Lasso.
- Ridge.
- Stacking-анасамбль.

Все модели сохранены в директории Models и готовы к использованию. 

## Анализ возможных дальнейших решений

Представленный код и методы работы являются авторским видением проекта. Возможно, представленный код не является наиболее оптимальным и "чистым". В то время как в рамках других решений могут быть использованы другие модели, более продвинутые методы очистки данных или подготовка итогового пайплайна. 

В рамках данного решения не ставилась задача построения оптимального решения, на оснвое продвинутых моделей, LLM и прочих современных технологий. Представленное решение является достаточно простым  и понятным и готово к применениею в бизнесе. 

В рамках дальнейших работ можно предложить следующее: 

1. Внедрить автоматизированные проверки качества поступающих данных. Реализовать алгоритм, который бы автоматически проверял данные, приводит их к общему виду, устранял выбросы и т.д. 
2. Разработать и внедрить алгоритм, который бы находил столбцы с высоким показателем мультиколлинеарности и принимал решения по устранению проблемы.
3. Возможно также формулирование аналогичной задачи, но не регрессии, а классификации. Так  как нам известно критическое значение, после которого использование Портала является опасным, то можно поставить задачу так: необходимо определить, является ли использование портала при заданных условиях опасным или безопасным. В таком случае задача будет являться задачей бинарной классификацией. 
4. Реализовать общий итоговый пайплайн в рамках одного скрипта Python. 

## Рекомендации

Также хотелось бы предложить следующие мероприятия по формированию необходимого датасета и постановки задачи в целом (предложение в рамках гипотетической задачи - предложение, которое бы направлялось бизнес-заказчикам): 

1. Формирование четких критериев приемки - каковы требования к качеству моделей, какие должны быть функциональные и нефункциональные требования и т.д. 
2. В рамках каких периодов необходимо переобучение модели на новых данных (каждый месяц, квартал и т.д). 
3. Провести интервью с заказчиками для понимания ценности модели машинного обучения для задач. Разработка ML-алгоритма является дорогим мероприятием. Действительно ли необходимо его создание или можно обойтись более простыми методами. 
4. Представленный датасет имеет порядка 12 тыс. наблюдений. Для более продвинутых моделей данных нужно гораздо больше. Будет ли возможность предоставить такие данные?
5. Сформулировать требования к безопасности (не украдут ли данные о модель агенты  Нильфгаарда).
6. Проработать сбор качественных данных. В рамках датасета были данные с большим количеством пропусков или столбцы с константными значениями. Нужен ли в итоге их сбор и анализ. 

# Вывод

Таким образом, в рамках кейса были рассмотрены все процессы построения моделей машинного обучения: начиная от анализа задачи и заканчивая выработкой рекомендаций. 

Построеные модели показали высокое качество и готовы к использованию. 

Работа над кейсом завершены. 
